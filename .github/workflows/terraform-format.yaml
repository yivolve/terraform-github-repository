name: "Terraform Format"
on:
  pull_request:
    branches: ["main"]

permissions:
  contents: read
  pull-requests: write

jobs:
  check:

    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - uses: hashicorp/setup-terraform@v3

      - name: Terraform Fmt
        id: fmt
        run: terraform fmt -check

      - name: Commit and Push new changes
        id: commit-and-push
        run: |
          echo SYNC_BRANCH=$(git config user.name github-actions && git config user.email github-actions@github.com && git add . && git commit -m "Saving new files for ${GITHUB_REF#refs/heads/} branch" && git push) >> $GITHUB_OUTPUT

      - name: Generate job summary
        if: always()
        run: |
          cat > "$GITHUB_STEP_SUMMARY" << EOL

          ### Branch Sync
          ${{ steps.commit-and-push.outputs.SYNC_BRANCH }}

          EOL
